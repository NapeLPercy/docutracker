<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DocuTracker</title>
    <link rel="stylesheet" href="styles.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="script.js" defer></script>

    <style>
      /* Floating Chatbot Button */
      .chatbot-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #ff9900, #ffcc00);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: bold;
        text-decoration: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        z-index: 9999;
        cursor: pointer;
      }

      .chatbot-btn:hover {
        transform: scale(1.15) rotate(10deg);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      }

      /**/

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .task-list {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      }

      .task-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .task-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .task-id {
        font-size: 0.9em;
        color: #666;
        font-family: "Courier New", monospace;
      }

      .batch-number {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(40, 167, 69, 0.3);
      }

      .role-badge {
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 0.9em;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .role-manager {
        background: linear-gradient(45deg, #ffc107, #ffeb3b);
        color: #333;
        box-shadow: 0 2px 10px rgba(255, 193, 7, 0.3);
      }

      .role-scanner {
        background: linear-gradient(45deg, #17a2b8, #20c997);
        color: white;
        box-shadow: 0 2px 10px rgba(23, 162, 184, 0.3);
      }

      .role-other {
        background: linear-gradient(45deg, #6f42c1, #e83e8c);
        color: white;
        box-shadow: 0 2px 10px rgba(111, 66, 193, 0.3);
      }

      .status-badge {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-pending {
        background: linear-gradient(45deg, #ffc107, #ffeb3b);
        color: #333;
      }

      .status-in-progress {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
      }

      .status-completed {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
      }

      .status-error {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
      }

      .task-details {
        margin: 15px 0;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      .detail-label {
        font-weight: 600;
        color: #555;
      }

      .detail-value {
        color: #333;
        font-family: "Courier New", monospace;
      }

      .date-value {
        font-size: 0.9em;
      }

      .task-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .action-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 0.85em;
        letter-spacing: 0.5px;
      }

      .btn-start {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .btn-end {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
      }

      .btn-error {
        background: linear-gradient(45deg, #ffc107, #ffeb3b);
        color: #333;
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
      }

      .btn-view {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }

      .action-btn:active {
        transform: translateY(0);
      }

      @media (max-width: 768px) {
        .task-list {
          grid-template-columns: 1fr;
        }

        .task-header {
          flex-direction: column;
          align-items: stretch;
        }

        .task-actions {
          justify-content: center;
        }
      }

      /*MANAGE USERS TABS*/
      /* Tabs */
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.tab-btn {
  padding: 8px 16px;
  border: none;
  background: #ffcc00;
  color: #333;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}

.tab-btn:hover {
  background: #ff9900;
  color: #fff;
}

.tab-btn.active {
  background: #ff9900;
  color: #fff;
}

/* Tab content */
.tab-content {
  padding: 10px 0;
  border-top: 2px solid #ffcc00;
}

      /*Loading tasks*/
      .loading-tasks {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white; /* DocuTracker theme */
        font-family: Arial, sans-serif;
        font-size: 1.1rem;
        padding: 20px;
      }

      .loading-tasks i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #ff9900; /* DocuTracker orange accent */
      }

      /*pop up*/
      /* üîπ Overlay */
      .popup-overlay {
        display: none; /* hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(3px);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      /* üîπ Popup Box */
      .popup-content {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        width: 320px;
        text-align: center;
        font-family: Arial, sans-serif;
        animation: fadeIn 0.3s ease-in-out;
      }

      /* Title & message */
      .popup-content h2 {
        margin-top: 0;
        font-size: 1.4rem;
        color: #333;
      }

      .popup-content p {
        color: #666;
        font-size: 1rem;
        margin: 10px 0 20px;
      }

      /* üîπ Buttons (DocuTracker theme) */
      .popup-buttons {
        display: flex;
        justify-content: space-between;
        gap: 10px;
      }

      .popup-buttons button {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s ease;
      }

      #popup-confirm {
        background: #ff9900; /* DocuTracker orange */
        color: white;
      }

      #popup-confirm:hover {
        background: #e68a00;
      }

      #popup-cancel {
        background: #ccc;
        color: #333;
      }

      #popup-cancel:hover {
        background: #bbb;
      }

      /* Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Overlay */

      /* Title */
      .popup-content h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: bold;
        color: #333;
      }

      /* Inputs */
      .popup-content label {
        font-weight: 500;
        display: block;
        margin-top: 10px;
        margin-bottom: 5px;
      }

      .popup-content .form-control {
        width: 100%;
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
        font-size: 14px;
      }

      /* Buttons */
      .popup-actions {
        margin-top: 15px;
        text-align: right;
      }

      .btn-submit {
        background: #ff9900;
        border: none;
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      .btn-submit:hover {
        background: #e68a00;
      }

      .btn-cancel {
        background: #ccc;
        border: none;
        color: #333;
        padding: 8px 14px;
        border-radius: 6px;
        margin-left: 8px;
        cursor: pointer;
      }

      .btn-cancel:hover {
        background: #b3b3b3;
      }

      /* Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .low-light {
        cursor: not-allowed; /* show ‚Äúblocked‚Äù cursor */
        opacity: 0.6; /* make it look faded */
        pointer-events: none; /* prevent clicks */
      }

      /*LIST OF USER RENDERER*/
.users-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

.users-table th,
.users-table td {
  border: 1px solid #ddd;
  padding: 10px;
  text-align: left;
}

.users-table th {
  background-color: #f4f4f4;
  font-weight: bold;
}


.user-info span {
  font-size: 14px;
  color: #333;
}

.user-status {
  font-weight: bold;
  font-size: 13px;
  margin-top: 4px;
}

.user-status.active {
  color: #28a745;
}

.user-status.inactive {
  color: #dc3545;
}

.delete-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #ff3333;
  font-size: 18px;
  transition: transform 0.2s;
}

.delete-btn:hover {
  transform: scale(1.2);
}


/*delete spinner*/
.loading-spinner i {
  color: #555;
  font-size: 14px;
}

    </style>
  </head>
  <body>
    <!-- Logo Wrapper -->

    <!-- Navigation Bar -->
    <nav class="navbar">
    

      <div class="nav-buttons">
  <h1 class="logo">
        <span class="logo-docu">Docu</span
        ><span class="logo-tracker">Tracker</span>
      </h1>

        <button
          class="nav-btn"
          id="about-btn"
          onclick="scrollToSection('about')"
        >
          <i class="fas fa-info-circle"></i> About & Features
        </button>

        <button
          class="nav-btn"
          id="how-it-works-btn"
          onclick="scrollToSection('howitworks')"
        >
          <i class="fas fa-rotate"></i> How it works
        </button>

        <button class="nav-btn" id="faqs-btn" onclick="scrollToSection('faqs')">
          <i class="fas fa-question"></i> FAQs
        </button>

        <button
          class="nav-btn"
          id="dashboard-btn"
          onclick="showSection('dashboard')"
        >
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </button>

        <button
          class="nav-btn"
          id="assign-tasks-btn"
          onclick="showSection('assigntasks')"
        >
          <i class="fas fa-tasks"></i> Assign Tasks
        </button>

        <button
          class="nav-btn"
          id="my-tasks-btn"
          onclick="showSection('mytasks')"
        >
          <i class="fas fa-clipboard-list"></i> My Tasks
        </button>

        <button
          class="nav-btn"
          id="reports-btn"
          onclick="showSection('reports')"
        >
          <i class="fas fa-chart-line"></i> Reports
        </button>

        <button
          class="nav-btn"
          id="ai-btn"
          onclick="scrollToSection('ai-usage')"
        >
          <i class="fas fa-robot"></i> AI
        </button>

        <button
          class="nav-btn"
          id="manage-users-btn"
          onclick="showSection('manageusers')"
          style="display: none;"
        >
          <i class="fas fa-user-cog"></i> Manage Users
        </button>

        <button
          class="nav-btn"
          id="login-btn"
          onclick="scrollToSection('login')"
        >
          <i class="fas fa-sign-in-alt"></i> Login
        </button>

        <button class="nav-btn" id="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </nav>

    <!-- Content Container -->
    <div class="content-container">

      <!-- User Info Card -->
<div id="user-info-card" class="user-card">
  <div class="user-icon">
    <i class="fas fa-user-circle"></i>
  </div>
  <div class="user-details">
    <h3 id="user-name">John Doe</h3>
    <p id="user-role"><i class="fas fa-user-tag"></i> Manager</p>
    <p id="session-time"><i class="fas fa-clock"></i> Session: 00:00:00</p>
  </div>
</div>


      <!-- About Section -->
      <div id="about" class="section">
        <h1>About DocuTracker</h1>
        <div class="about-container">
          <div class="about-info">
            <h2>What is DocuTracker?</h2>
            <p>
              <strong>DocuTracker</strong> is a smart task management and
              document digitization platform designed for high-efficiency
              environments like public service hubs. It simplifies the workflow
              by enabling managers to assign, track, and report on
              document-related tasks in real time.
            </p>

            <h3 style="margin-top: 20px">Why Use DocuTracker?</h3>
            <p>
              DocuTracker helps managers make informed decisions when assigning
              tasks ‚Äî ensuring the right person is selected for the job based on
              role, availability, and workload history. It even considers the
              timing of previous assignments to optimize performance and reduce
              idle time.
            </p>
          </div>

          <div class="features-box">
            <h2>Key Features</h2>
            <div class="feature-columns">
              <div class="feature-column">
                <h3><i class="fas fa-user-shield"></i> Manager Tools</h3>
                <ul>
                  <li>Assign tasks by role or availability</li>
                  <li>View performance insights and history</li>
                  <li>Monitor workflow and efficiency in real time</li>
                  <li>Generate and export activity reports</li>
                </ul>
              </div>
              <div class="feature-column">
                <h3><i class="fas fa-user-check"></i> Worker Dashboard</h3>
                <ul>
                  <li>View assigned tasks and due dates</li>
                  <li>Update task progress with ease</li>
                  <li>Mark completion and add comments</li>
                  <li>Track personal performance trends</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- How It Works Section -->
      <div id="howitworks" class="section">
        <h1>How It Works</h1>
        <div class="how-steps">
          <div class="step">
            <i class="fas fa-file-import step-icon"></i>
            <h3>Step 1: Receive Physical Documents</h3>
            <p>
              Drivers deliver batches of physical documents to the digitization
              hub.
            </p>
          </div>
          <div class="step">
            <i class="fas fa-tasks step-icon"></i>
            <h3>Step 2: Assign Tasks</h3>
            <p>
              Managers assign roles like indexing, scanning, QC, and assembly to
              staff.
            </p>
          </div>
          <div class="step">
            <i class="fas fa-user-clock step-icon"></i>
            <h3>Step 3: Perform & Track Work</h3>
            <p>
              Staff complete their assigned tasks, and the system tracks time,
              status, and performance.
            </p>
          </div>
          <div class="step">
            <i class="fas fa-chart-line step-icon"></i>
            <h3>Step 4: Monitor & Report</h3>
            <p>
              Managers use the dashboard to monitor progress, generate reports,
              and ensure efficiency.
            </p>
          </div>
        </div>
      </div>

      <!-- FAQ Section -->
      <div id="faqs" class="section">
        <h1>Frequently Asked Questions</h1>
        <div class="faq-container">
          <div class="faq-item">
            <h3><i class="fas fa-question-circle"></i> What is DocuTracker?</h3>
            <p>
              DocuTracker is a task and workflow manager designed for
              digitization hubs handling sensitive documents. It allows managers
              to assign and monitor tasks while workers execute them
              efficiently.
            </p>
          </div>
          <div class="faq-item">
            <h3><i class="fas fa-user-lock"></i> Who can access the system?</h3>
            <p>
              Only authorized personnel with login credentials: managers,
              indexers, scanners, QC staff, and assembly workers.
            </p>
          </div>
          <div class="faq-item">
            <h3><i class="fas fa-shield-alt"></i> Is my data secure?</h3>
            <p>
              Yes. DocuTracker uses secure server communication and validates
              user access at every step to maintain document integrity and
              privacy.
            </p>
          </div>
          <div class="faq-item">
            <h3><i class="fas fa-bolt"></i> How fast is task tracking?</h3>
            <p>
              Updates happen in real time. As tasks are completed or delayed,
              the dashboard reflects changes instantly.
            </p>
          </div>
        </div>
      </div>

      <!-- AI Usage Section -->
      <div id="ai-usage" class="section">
        <h1><i class="fas fa-brain"></i> How DocuTracker Uses AI</h1>
        <div class="ai-grid">
          <div class="ai-card">
            <i class="fas fa-user-check ai-icon"></i>
            <h3>Smart Task Assignment</h3>
            <p>
              AI analyzes worker roles, task history, and availability to
              recommend or automatically assign the most suitable person for
              each task ‚Äî helping managers save time and improve accuracy.
            </p>
          </div>

          <div class="ai-card">
            <i class="fas fa-search ai-icon"></i>
            <h3>Anomaly Detection</h3>
            <p>
              The system detects unusual behavior or inconsistencies in task
              flow ‚Äî like skipped steps, unusually fast completions, or repeated
              delays ‚Äî helping managers take corrective action quickly.
            </p>
          </div>

          <div class="ai-card">
            <i class="fas fa-clock ai-icon"></i>
            <h3>Time Estimation & Planning</h3>
            <p>
              Based on task type and user performance data, AI predicts
              estimated completion times. This helps in planning workloads,
              avoiding bottlenecks, and staying ahead of deadlines.
            </p>
          </div>

          <div class="ai-card">
            <i class="fas fa-robot ai-icon"></i>
            <h3>AI Chatbot Assistant</h3>
            <p>
              A built-in assistant helps workers understand their roles,
              navigate the system, and get answers to common questions. Managers
              can also ask the bot for stats or guidance on assignments.
            </p>
          </div>
        </div>
      </div>

      <!-- Login Section -->
      <div id="login" class="section">
        <h1>Welcome Back</h1>
        <div class="login-form">
          <div class="form-group">
            <label for="username"
              >Email:<span id="username_error"> Email is required</span></label
            >
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="form-group">
            <label for="password"
              >Password:<span id="password_error">
                Password is required</span
              ></label
            >
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Enter your password"
              required
            />
          </div>
          <span id="login-error"></span>
          <button class="login-btn" onclick="handleLogin(this)">Sign In</button>
        </div>
      </div>

      <!-- Manage Users Section -->
<div id="manageusers" class="section">
  <h1>Manage Users</h1>
  <p>Add new personnel or view current users.</p>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="openTab(event, 'add-user-tab')">
      Add User
    </button>
    <button class="tab-btn" onclick="openTab(event, 'view-users-tab')">
      View Users
    </button>
  </div>

  <!-- Tab Contents -->
  <div class="tab-content" id="add-user-tab">
    <div class="login-form">
      <!-- Persal Number -->
      <div class="form-group">
        <label for="persal-number">
          Persal Number:<span class="user_error" id="persal_error"></span>
        </label>
        <input
          type="text"
          id="persal-number"
          name="persal-number"
          placeholder="Enter persal number"
          required
        />
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="emails">
          Email:<span class="email_error" id="email_error"></span>
        </label>
        <input
          type="email"
          id="emails"
          name="email"
          placeholder="Enter Email"
          required
        />
      </div>

      <!-- Surname -->
      <div class="form-group">
        <label for="surname">
          Surname:<span class="user_error" id="surname_error"></span>
        </label>
        <input
          type="text"
          id="surname"
          name="surname"
          placeholder="Enter surname & initials"
          required
        />
      </div>

      <!-- Role Selection -->
      <div class="form-group">
        <label for="role-add">
          Role:<span class="user_error" id="role_add_error"></span>
        </label>
        <select id="role-add" name="role-add" required>
          <option value="">-- Select a Role --</option>
          <option value="INDEXER">Indexer</option>
          <option value="CREATOR">Batch Creator</option>
          <option value="ASSEMBLER">Assembler</option>
          <option value="QC">QC</option>
          <option value="SCANNER">Scanner</option>
          <option value="RUNNER">Runner</option>
        </select>
      </div>

      <!-- Submit -->
      <span id="adduser-error"></span>
      <button class="add-user-btn" onclick="addUser()">Add User</button>
    </div>
  </div>

  <div class="tab-content" id="view-users-tab" style="display:none;">
  <h3>Current Users</h3>
  <div id="users-list">
    <!-- Users will be rendered here dynamically -->
  </div>
</div>



</div>

      <!-- Assign Task Section -->
      <div id="assigntasks" class="section">
        <h1>Assign Task</h1>
        <div class="login-form">
          <div class="form-group">
            <label for="batch-number">
              Batch Number:<span class="assign_error" id="batch_error"> </span>
            </label>
            <input
              type="text"
              id="batch-number"
              name="batch-number"
              placeholder="Enter batch number"
              required
            />
          </div>

          <div class="form-group">
            <label for="role-select">
              Select Role:<span class="assign_error" id="role_error"></span>
            </label>
            <select
              id="role-select"
              name="role-select"
              onchange="loadWorkersByRole()"
              required
            >
              <option value="">-- Select a Role --</option>
                      <option value="INDEXER">Indexer</option>
          <option value="CREATOR">Batch Creator</option>
          <option value="ASSEMBLER">Assembler</option>
          <option value="QC">QC</option>
          <option value="SCANNER">Scanner</option>
          <option value="RUNNER">Runner</option>
              
            </select>
          </div>

          <div class="form-group">
            <label for="worker-select">
              Available Workers:<span class="assign_error" id="worker_error">
              </span>
            </label>
            <select id="worker-select" name="worker-select" required>
              <option value="">-- Select personell --</option>
              <!-- Options to be populated dynamically based on role -->
            </select>
          </div>

          <span id="assign-error"></span>
          <button class="login-btn" onclick="assignTask()">Assign Task</button>
        </div>
      </div>

      <!-- Dashboard Section -->
      <!-- Dashboard Section -->
      <div id="dashboard" class="section" style="display: none">
        <h1>Dashboard Overview</h1>
        <p>
          Welcome to your dashboard! Here's a quick overview of your system
          metrics.
        </p>

        <div class="section-load"></div>

        <!-- Stats Grid -->
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h3>Total Tasks</h3>
            <div class="metric" id="total-tasks">0</div>
            <p>Assigned to you</p>
          </div>
          <div class="dashboard-card">
            <h3>Completed</h3>
            <div class="metric" id="completed-tasks">0</div>
            <p>Successfully finished</p>
          </div>
          <div class="dashboard-card">
            <h3>Pending</h3>
            <div class="metric" id="pending-tasks">0</div>
            <p>Still awaiting</p>
          </div>

          <!-- Manager-only -->
          <div class="dashboard-card manager-only" style="display: none">
            <h3>Active Members</h3>
            <div class="metric" id="active-members">0</div>
            <p>Currently busy</p>
          </div>

          <div class="dashboard-card manager-only" style="display: none">
            <h3>Avg Time</h3>
            <div class="metric" id="all-avg-time">0m</div>
            <p>For all workers</p>
          </div>

          <!-- Worker-only -->
          <div class="dashboard-card worker-only" style="display: none">
            <h3>Total Reports</h3>
            <div class="metric" id="total-reports">0</div>
            <p>Issues linked to your tasks</p>
          </div>

          <div class="dashboard-card worker-only" style="display: none">
            <h3>Efficiency</h3>
            <div class="metric" id="efficiency-score">0%</div>
            <p>Performance score</p>
          </div>

          <div class="dashboard-card worker-only" style="display: none">
            <h3>Avg Time</h3>
            <div class="metric" id="avg-time">0m</div>
            <p>Per completed task</p>
          </div>
        </div>

        <!-- Report Summary Chart -->
        <div class="dashboard-card full-width">
          <h3>Report Summary</h3>
          <canvas id="reportChart"></canvas>
        </div>
      </div>

      <!-- Task Manager Section -->
      <div id="mytasks" class="section" style="display: none">
        <h1>My Tasks</h1>
        <p>Manage and track your tasks efficiently.</p>

          <div class="tasks-load"></div>

        <h2>Current Tasks</h2>
        <div class="task-list"></div>
      </div>

      <!-- Reports Section -->
  <!-- Reports Section -->
<div id="reports" class="section" style="display: none">
  <h1>Reports & Analytics</h1>
  <p>View detailed reports and performance analytics.</p>


   <div class="reports-load"></div>

  <h2>Monthly Performance Report</h2>

   

  <table class="reports-table">
    <thead>
      <tr>
        <th>Metric</th>
        <th>Current Month</th>
        <th>Previous Month</th>
        <th>Change</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Tasks Completed</strong></td>
        <td id="tasksCompletedCurrent"></td>
        <td id="tasksCompletedPrevious"></td>
        <td id="tasksCompletedChange"></td>
      </tr>
      <tr>
        <td><strong>User Engagement</strong></td>
        <td id="userEngagementCurrent"></td>
        <td id="userEngagementPrevious"></td>
        <td id="userEngagementChange"></td>
      </tr>
      <tr>
        <td><strong>Error Rate</strong></td>
        <td id="errorRateCurrent"></td>
        <td id="errorRatePrevious"></td>
        <td id="errorRateChange"></td>
      </tr>
    </tbody>
  </table>

  <div id="render-reports">

  </div>
</div>


    <!-- üîπ Popup Structure -->
    <div id="taskPopup" class="popup-overlay">
      <div class="popup-content">
        <h2 id="popup-title">Start Task</h2>
        <p id="popup-message">Are you sure you want to start this task?</p>
        <span id="load"></span>
        <div class="popup-buttons">
          <button id="popup-confirm">Confirm</button>
          <button id="popup-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Report Popup -->
    <div id="reportPopup" class="popup-overlay" style="display: none">
      <div class="popup-content">
        <h3>Report Task</h3>
<p id="report-task-alert"></p>

        <label for="reportType">Select Type:</label>
        <select id="reportType" class="form-control">
          <option value="error">Error / Issue</option>
          <option value="delay">Delay</option>
          <option value="suggestion">Suggestion / Improvement</option>
          <option value="comment">General Comment</option>
        </select>

        <label for="reportMessage">Comment:</label>
        <textarea
          id="reportMessage"
          class="form-control"
          rows="4"
          placeholder="Write your report..."
        ></textarea>

        <div class="popup-actions">
          <button class="btn-submit" onclick="submitReport()">Submit</button>
          <button class="btn-cancel" onclick="closeReportPopup()">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Floating AI Chatbot Button -->
    <a
      href="#"
      onclick="openChatbot()"
      target="_blank"
      class="chatbot-btn"
      title="Chat with AI"
    >
      <span>ü§ñ</span>
    </a>

    <footer class="footer">
      <div class="footer-content">
        <p class="footer-logo">
          <span class="logo-docu">Docu</span
          ><span class="logo-tracker">Tracker</span>
        </p>
        <p class="footer-tagline">¬© 2025 DocuTracker. All rights reserved.</p>
        <p class="footer-note">The Smart Efficiency Tracking System</p>
      </div>
    </footer>


    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
<script>
  // Initialize EmailJS
  emailjs.init("ks8AivME9t0OkTD68"); // Replace with your EmailJS public key

  function sendDocuTrackerEmail(name, message) {
    // Create a "params" object matching your EmailJS template variables
    const templateParams = {
      name: name,
      message: message
    };

    // Send email using your Service ID and Template ID
    emailjs.send("service_z77xzob", "template_bl66ibc", templateParams)
      .then(function(response) {
        console.log("‚úÖ Email sent successfully!", response.status, response.text);
      }, function(error) {
        console.error("‚ùå Failed to send email:", error);
      });
  }

  
</script>


    <script>
      function openChatbot() {
        // Opens chatbot.html in a new small popup window
        window.open(
          "public/chatbot.html",
          "Chatbot",
          "width=400,height=600,left=100,top=100,resizable=yes,scrollbars=yes"
        );
      }

      function showPopup(title, message, id, act) {
        let titleEl = document.getElementById("popup-title");
        let messageEl = document.getElementById("popup-message");

        titleEl.textContent = title;
        messageEl.textContent = message;

        const popup = document.getElementById("taskPopup");

        popup.style.display = "flex";

        // Confirm button
        document.getElementById("popup-confirm").onclick = () => {
          // popup.style.display = "none";
          if (act === "start") {
            showLoading(messageEl, "Starting");
            startTask(id);
          } else if (act === "end") {
            showLoading(messageEl, "Ending");
            endTask(id);
          }
        };

        // Cancel button
        document.getElementById("popup-cancel").onclick = () => {
          popup.style.display = "none";
        };
      }

      function showLoading(titleEl, action) {
        titleEl.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${action} task...`;
      }

      //User begins thier task
      function startTask(id) {
        console.log("Starting this task", id);
        const popup = document.getElementById("taskPopup");
        let messageEl = document.getElementById("popup-message");

        fetch(`http://localhost:3000/task/${id}/start`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            status: "IN_PROGRESS",
            persalNumber: user.persalNumber,
          }), // you can set status however you like
        })
          .then((res) => {
            if (!res.ok) {
              messageEl.innerHTML = "An error occured, try again!!";
              throw new Error("Failed to start task");
            }
            return res.json();
          })
          .then((data) => {
            console.log("Task started:", data);
            if (data.success) {
              getMyTasks();
            } else {
              messageEl.innerHTML = "An error occured, try again!!";
            }

            setTimeout(() => {
              popup.style.display = "none";
            }, 1000);
          })
          .catch((err) => console.error("Error:", err));
      }

      //User end thier task
      function endTask(id) {
        console.log("Ending this task", id);
        const popup = document.getElementById("taskPopup");
        let messageEl = document.getElementById("popup-message");

        fetch(`http://localhost:3000/task/${id}/end`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            status: "COMPLETED",
            persalNumber: user.persalNumber,
          }), // you can set status however you like
        })
          .then((res) => {
            if (!res.ok) {
              messageEl.innerHTML = "An error occured, try again!!";
              throw new Error("Failed to end task");
            }
            return res.json();
          })
          .then((data) => {
            console.log("Task ended:", data);
            if (data.success) {
              getMyTasks();
            } else {
              messageEl.innerHTML = "An error occured, try again!!";
            }

            setTimeout(() => {
              popup.style.display = "none";
            }, 3000);
          })
          .catch((err) => console.error("Error:", err));
      }

      let id = null;

      function openReportPopup(taskId) {
        id = taskId;
        document.getElementById("reportPopup").style.display = "flex";
      }

      function closeReportPopup() {
        document.getElementById("reportPopup").style.display = "none";
        document.getElementById("reportMessage").value = "";
      }

      function submitReport() {

        const type = document.getElementById("reportType").value;
        const message = document.getElementById("reportMessage").value;

        const messageEl = document.getElementById("report-task-alert");
        if (message.trim() === "") {
          alert("Please enter a comment before submitting.");
          return;
        }

      
        messageEl.innerHTML = `<i class="fas fa-spinner fa-spin"></i>Reporting Task`;
  

        // Send data to backend
        fetch(`http://localhost:3000/task/${id}/report`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            type: type,
            message: message,
            role: user.role,
          }),
        })
          .then((res) => res.json())
          .then((data) => {

            setTimeout(() => {
                if (data.success) {
              messageEl.innerHTML = "Report submitted";
            
            } else {
                messageEl.innerHTML = "Report not submitted";
            }
              closeReportPopup();
            }, 2000);

          
          })
          .catch((err) => {
            console.error("Error:", err);
            alert("Failed to connect to server.");
          });
      }

      //Add user
      function addUser() {
        const persalNumber = document
          .getElementById("persal-number")
          .value.trim();
        const surname = document.getElementById("surname").value.trim();
        const email = document.getElementById("emails").value.trim();
        const role = document.getElementById("role-add").value;

        // Simple validation
        if (!persalNumber || !surname || !email || !role) {
          alert("‚ö†Ô∏è Please fill in all fields before submitting.");
          return;
        }

        const payload = {
          persal_number: persalNumber,
          surname: surname,
          role: role,
          email: email
        };

        console.log("Here we go", payload);
     
        // Loading state
        const btn = document.querySelector(".add-user-btn");
        btn.disabled = true;
        btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Adding...`;

        fetch("http://localhost:3000/users", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        })
          .then((res) => res.json())
          .then((data) => {
            console.log("Just fetched data",data);
            if (data.success) {
              alert("‚úÖ User added successfully!");
              document.getElementById("persal-number").value = "";
              document.getElementById("surname").value = "";
              document.getElementById("role-add").value = "";
              document.getElementById("emails").value = "";

              // Example usage
  sendDocuTrackerEmail(
    " New User üéâ",
    "Your account has been created successfully.  Your password is "+data.generatedPasword
  );
              //generatePassword(email,persalNumber);
            } else {
              alert(
                "‚ùå Failed to add user: " + (data.error || "Unknown error")
              );
            }
          })
          .catch((err) => {
            console.error("Error adding user:", err);
            alert("‚ùå Could not connect to server.");
          })
          .finally(() => {
            btn.disabled = false;
            btn.innerHTML = `Add User`;
          });
      }

      //TABS HANDLER
      function openTab(evt, tabId) {
  // Hide all tab contents
  const tabContents = document.querySelectorAll(".tab-content");
  tabContents.forEach((content) => (content.style.display = "none"));

  // Remove active class from all buttons
  const tabBtns = document.querySelectorAll(".tab-btn");
  tabBtns.forEach((btn) => btn.classList.remove("active"));

  // Show selected tab
  document.getElementById(tabId).style.display = "block";
  evt.currentTarget.classList.add("active");

  if(tabId === "view-users-tab"){
getUsers();
  }
}

    </script>
  </body>
</html>
